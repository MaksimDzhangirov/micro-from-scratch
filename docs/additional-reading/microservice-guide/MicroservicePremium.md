# Издержки микросервисов

13 мая 2015

![Martin Fowler](images/microservices/mf.jpg)

[Мартин Фаулер](https://martinfowler.com/)

[МИКРОСЕРВИСЫ](https://martinfowler.com/tags/microservices.html)

[Архитектурный стиль микросервисов](https://martinfowler.com/articles/microservices.html) был горячо обсуждаемой темой в прошлом году.
На недавней конференции [O'Reilly по программной архитектуре](http://softwarearchitecturecon.com/sa2015) казалось, что на 
каждой сессии говорили о микросервисах. Достаточно, чтобы эта тема была у всех
на слуху и все о ней говорили. Одним из последствий этого является то, что мы 
видели команды, которые слишком стремились использовать микросервисы, [[1](https://martinfowler.com/bliki/MicroservicePremium.html#footnote-envy)] не 
понимая, что микросервисы создают сложность сами по себе. Это увеличивает 
стоимость и риск проекта, что часто приводит к серьезным проблемам.

Хотя эта шумиха вокруг микросервисов раздражает, я думаю, что это полезная 
терминология для стиля архитектуры, который существует уже некоторое время, но 
нуждается в имени, чтобы о нем было легче говорить. Здесь важно не то, насколько 
вас раздражает шумиха, а архитектурный вопрос, который она поднимает: **является 
ли микросервисная архитектура хорошим выбором для системы, над которой вы 
работаете?**

Kent Beck

любой хороший ответ на интересный вопрос начинается со слов "это зависит от..."

«Это зависит» так должен начаться мой ответ, но затем я должен сместить акцент 
на то, от каких факторов это зависит. Точка опоры при выборе использования 
микросервисов зависит от сложности системы, которую вы рассматриваете. Подход 
микросервисов заключается в работе со сложной системой, но для этого этот 
подход вводит свой собственный набор сложностей. Когда вы используете 
микросервисы, вы должны работать над автоматическим развертыванием, мониторингом, 
обработкой сбоев, согласованностью по событиям и другими факторами, которые 
вводит распределенная система. Есть хорошо известные способы справиться со всем 
этим, но это дополнительные усилия, и ни у кого из моих знакомых в разработке 
программного обеспечения, похоже, нет уймы свободного времени.

![productivity](images/MicroservicePremium/productivity.png)

Так что мой основной совет — **даже не рассматривайте микросервисы, если только 
ваша система слишком сложна для управления в виде монолита**. Большинство 
программных систем должны быть построены как единое монолитное приложение. 
Обратите внимание на хорошую модульность в этом монолите, но не пытайтесь 
разделить его на отдельные сервисы.

Сложность, которая побуждает нас переходить к микросервисам, может исходить из 
многих источников, включая работу с большими командами [[2]()], [мультиарендность](http://samnewman.io/blog/2015/05/05/single-tenancy-vs-multi-tenancy/), 
поддержку множества моделей взаимодействия с пользователем, возможность 
независимого развития различных бизнес-функций и масштабирование. Но самым 
важным фактором является размер — люди обнаруживают, что у них есть монолит, 
который слишком велик, чтобы его можно было модифицировать и развертывать.

В этот момент я чувствую определенное разочарование. Многие из проблем, 
приписываемых монолитам, не являются существенными для этого стиля. Я слышал, 
что люди говорят, что вам нужно использовать микросервисы, потому что [непрерывная 
доставка](https://martinfowler.com/bliki/ContinuousDelivery.html) с монолитами 
невозможна, но есть много организаций, которые преуспевают с [шаблонным подходом 
к развертыванию](http://paulhammant.com/2011/11/29/cookie-cutter-scaling/): 
Facebook и Etsy — два хорошо известных примера.

Я также слышал аргументы в пользу того, что по мере увеличения размера системы 
необходимо использовать микросервисы, чтобы иметь части, которые легко 
модифицировать и заменять. Тем не менее, нет никаких причин, по которым вы не 
можете создать единый монолит с четко определенными границами модулей. По 
крайней мере, в теории нет никакой причины, на практике слишком легко нарушить 
границы модулей, а монолиту стать запутанным, а также большим.

Мы также должны помнить, что существуют существенные различия в размере сервиса 
между различными микросервисными системами. Я видел, как микросервисные системы 
варьируются от команды из 60 человек с 20 сервисами до команды из 4 человек с 
200 сервисами. Непонятно, в какой степени размер услуги влияет на издержки.

По мере того, как размер и другие сложности вносят свой вклад в 
проект, я видел, как многие команды приходят к выводу, что микросервисы — это 
лучшее решение. Но если вы не сталкивались с такой сложностью, помните, 
что подход с использованием микросервисов требует больших затрат, которые могут 
значительно замедлить вашу разработку. Поэтому, если вы можете сделать свою 
систему достаточно простой, чтобы избежать необходимости в микросервисах: 
сделайте это.

## Примечания

1: Это достаточно распространенная проблема, которую наш недавний радар 
назвал [Microservice Envy](http://www.thoughtworks.com/radar/techniques/microservice-envy).

2: [Закон Конвея](http://www.thoughtworks.com/insights/blog/demystifying-conways-law) гласит, что 
структура системы соответствует организации людей, которые ее построили. В некоторых
примерах использования микросервисов организации преднамеренно разделялись на 
небольшие, слабо связанные группы, чтобы программное обеспечение имело 
аналогичную модульную структуру — понятие, которое называется [обратным маневром 
Конвея](http://www.thoughtworks.com/radar/techniques/inverse-conway-maneuver).

## Благодарности

Я позаимствовал большую часть этих мыслей у своих коллег: Джеймса Льюиса, 
Сэма Ньюмана, Тиягу Паланисами и Эвана Ботчера. Комментарии Стефана Тилкова к 
предыдущему черновику сыграли важную роль в уточнении этого поста. Роб Майлз, 
Дэвид Нельсон, Брайан Мейсон и Скотт Робинсон обсуждали черновики этой статьи 
в нашем внутреннем списке писем.