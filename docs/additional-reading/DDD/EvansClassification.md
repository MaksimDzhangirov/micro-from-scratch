# Классификация Эванса

14 декабря 2005

![Martin Fowler](../microservice-guide/images/microservices/mf.jpg)

[Мартин Фаулер](https://martinfowler.com/)

[ПРЕДМЕТНО-ОРИЕНТИРОВАННОЕ ПРОЕКТИРОВАНИЕ](https://martinfowler.com/tags/domain%20driven%20design.html)

В своей превосходной книге [Предметно-ориентированное проектирование](https://www.amazon.com/gp/product/0321125215/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0321125215&linkCode=as2&tag=martinfowlerc-20) Эрик Эванс 
создает классификацию различных типов объектов предметной области, с которыми 
вы, вероятно, столкнетесь.

* **Сущность**: Объекты, имеющие четкую идентичность, которая проходит 
  через время и различные представления. Вы также слышали, что это называется 
  «ссылочными объектами».
* **Объекты-значения**: Объекты, которые имеют значение только как комбинация 
  их атрибутов. Два объекта-значения с одинаковыми значениями всех атрибутов 
  считаются равными. Я также описываю [объекты-значения](https://martinfowler.com/eaaCatalog/valueObject.html) 
  в [Шаблонах корпоративных приложений](https://martinfowler.com/books/eaa.html).
* **Сервис**: автономная операция в контексте вашей предметной области. **Объект сервиса** 
  собирает один или несколько сервисов в объект. Обычно у вас будет только один 
  экземпляр каждого типа объекта сервиса в вашем контексте выполнения.

Эта классификация хорошо согласуется с моим опытом в отношении того, что вам 
нужно в моделях предметной области. Беда в том, что трио трудно определить 
точно, они из категории «я узнаю их, когда вижу».

Таким образом, некоторые примеры могут помочь. Сущности обычно представляют 
собой большие объекты, такие как «Клиент», «Корабль», «Договор об аренде». Объекты-значения 
обычно представляют собой такие небольшие объекты, как дата, деньги, запрос к 
базе данных. Службы обычно представляют собой доступ к внешним ресурсам, таким 
как подключение к базе данных, шлюз обмена сообщениями, репозиторий, 
фабрика товаров.

Одно чёткое различие между сущностями и объектами-значениями заключается в том,
что объекты-значения переопределяют метод равенства (и, следовательно, хэш), в 
то время как сущности обычно этого не делают. Это связано с тем, что вы обычно 
не хотите иметь более одного объекта, представляющего одну и ту же концептуальную 
сущность в вашем контексте обработки, однако ничего страшного, если у вас будет 
несколько объектов-значений равных «5.0». Объекты-значения могут быть примитивами
(в языках, которые делают различие) или специальную языковую поддержку (как в 
.NET), но это не обязательно. Важно следовать одному правилу: объекты-значения 
должны быть неизменяемыми (в противном случае вы столкнетесь со всевозможными 
проблемами, связанными с псевдонимами). Чтобы изменить объект-значение (например, 
мой рост), вы не меняете объект-значение высоты, вы заменяете его новым.

Объекты сервисы часто реализуются с использованием глобальных переменных, 
полей класса (моносостояний в терминологии Роберта Мартина) или синглтонов. Конечно
они обычно присутствуют в единственном число, поскольку у вас есть только один 
из них, но то, как вы их используете, более разнообразно. Обычно единственность
заключается в контексте обработки, то есть по одному на поток в многопоточной 
среде. В любом случае вы должны убедиться, что ваш механизм реализации скрыт от 
других объектов предметной области, чтобы вы могли легко изменить его. Эрик 
утверждает в своей книге, что сервисы не должны иметь состояния. Хотя когда мы
говорили с ним об этом, он больше не считает, что это необходимо — хотя хорошо, 
если вы можете это сделать.

Одна из проблем в этой области заключается в том, что эта терминология, хотя 
и вызывающая воспоминания, ужасно смешивается с другими идеями. Сущность часто 
используется для представления таблицы базы данных или объекта, который 
соответствует таблице базы данных. Сервис включает в себя всю сервисно-ориентированную 
архитектуру, а также сервисные уровни в архитектуре приложений. Поэтому, если я 
использую эти термины, я должен четко указать, что я использую их в контексте 
моделей предметной области и в соответствии с их значением в книге Эрика. Так 
что будьте осторожны, предполагая, что люди используют эти слова вот так — они 
имеют множество значений. К сожалению, альтернатив не так много.